<!DOCTYPE html>
<html>
  <head>
    <title>Visual Search Task</title>
    <script src="jspsych/dist/jspsych.js"></script>
    <script src="jspsych/dist/plugin-html-keyboard-response.js"></script>
    <script src="jspsych/dist/plugin-fullscreen.js"></script>
    <script src="shuffled_stimuli.js"></script>
    <script src="jquery-3.6.4.min.js"></script>
    <link href="jspsych/dist/jspsych.css" rel="stylesheet" type="text/css" />
  </head>
<body></body>
  <script>
  // Load JS file
  $.getJSON('shuffled_stimuli.js', function(data) {
  
  // Get the data from the JS file
  const items = data.items;
  
  // Split the comma-separated string in one of the columns
  items.forEach(item => {
    item.stimuli = item.stimuli.split(',');
  });
});
  
  // Convert JS to array
  var names = []
  for(x in shuffled_stimuli)
  names.push(shuffled_stimuli[x].stimuli);

  // split the comma-separated words
  myArray = names.map(str => str.split(","));

  // define a function to shuffle the array
function shuffleArray(firstRow) {
  for (let i = firstRow.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [firstRow[i], firstRow[j]] = [firstRow[j], firstRow[i]];
  }
  return firstRow;
}

  /* create timeline */
  var timeline = [];

  /* start the experiment */
  var jsPsych = initJsPsych({
});

  // Define a jsPsych trial to display the words
  var wordDisplayTrial = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: function() {
      const quadrantSize = window.innerWidth / 4;
      const centerX = window.innerWidth / 3;
      const centerY = window.innerHeight / 3;
      const quadrants = [
        { x: 0, y: 0 },
        { x: quadrantSize, y: 0 },
        { x: 0, y: quadrantSize },
        { x: quadrantSize, y: quadrantSize },
      ];
      const firstRow = myArray.pop();
      shuffleArray(firstRow);

      let html = '';
      for (let i = 0; i < 4; i++) {
        html += `<div class="word" style="position:absolute; top:${centerY + quadrants[i].y}px; left:${centerX + quadrants[i].x}px;">${firstRow[i]}</div>`;
      }
      return html;
    },
    choices: ['z', 'm'],
    trial_duration: 3000,
  };

var fixation = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus: '<div style="font-size:60px;">+</div>',
  choices: "NO_KEYS",
  trial_duration: 1000,
};

// Define a jsPsych timeline and add the word display trial
var test_procedure = {
  timeline: [fixation, wordDisplayTrial],
  repetitions: 5,
  timeline_variables:  firstRow
}

// timeline.push(wordDisplayTrial);
timeline.push(test_procedure);

jsPsych.run(timeline);

</script>
</html>

